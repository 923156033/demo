+function(d){var a=function(f,e){Util.assert(d.fn.extPopupCaptchaCode,"依赖组件 $.fn.extPopupCaptchaCode 未引入");this.$element=d(f);this.options=d.extend({},a.DEFAULTS,e);this.init()};a.VERSION="1.0.0";a.DEFAULTS={sendButtonText:"发送短信验证码"};a.prototype.init=function(){var g=this;var e=this.$element;var f=this.options;if(f.ruleMobile==undefined){e.attr("data-rule-mobile",true)}e.wrap('<div class="input-group"></div>');var h=d('<button type="button" class="btn red">'+f.sendButtonText+"</button>");e.after(d('<span class="input-group-btn"></span>').append(h));h.on("click",function(){if(e.valid()){h.extPopupCaptchaCode({callbackVal:function(i){h.attr("disabled",true);h.html("正在发送...");h.ajaxJsonUrl("/pub/send-sms-code/"+e.val()+"?captcha="+i,function(j){if(j.type=="success"){if(j.message){Global.notify("info",j.message)}h.html("<i>已发送<span class='small'>(<span class='count'> 60 </span>秒后可重发)</span></i>");window.timer=setInterval(function(){var k=h.find(".count").html();if(k<=0){h.attr("disabled",false);h.html(f.sendButtonText);clearInterval(window.timer)}else{k=Number(k)-1;h.html("<i>已发送<span class='small'>(<span class='count'> "+k+" </span>秒后可重发)</span></i>")}},1000)}else{Global.notify("warning",j.message);h.attr("disabled",false);h.html(f.sendButtonText)}})}});h.extPopupCaptchaCode("show")}})};function c(e){return this.each(function(){var h=d(this);var g=h.data("ExtMobileSmsCode");var f=typeof e=="object"&&e;if(!g){h.data("ExtMobileSmsCode",(g=new a(this,f)))}if(typeof e=="string"){g[e]()}})}var b=d.fn.extMobileSmsCode;d.fn.extMobileSmsCode=c;d.fn.extMobileSmsCode.noConflict=function(){d.fn.extMobileSmsCode=b;return this};Global.addComponent({name:"ExtMobileSmsCode",plugin:c,runPoint:Global.Component_Run_Point.BeforeAjaxPageShow,expr:'input[data-toggle="mobile-sms-code"]'})}(jQuery);