+function(c){var d=function(f,e){this.$element=c(f);this.options=c.extend({},d.DEFAULTS,e);this.init()};d.VERSION="1.0.0";d.DEFAULTS={multiple:false,height:"120px",width:"120px",maximumSelectionLength:0,imageHeight:"100%",imageWidth:"100%"};d.prototype.loadKindEditor=function(g){var e=this.options;var f=this.kindEditor;if(!f){f=KindEditor.editor({uploadJson:Util.smartParseURL(Config.getFileUploadUrl()),allowFileManager:false,formatUploadUrl:false,afterUpload:g});this.kindEditor=f}f.loadPlugin("image",function(){f.plugin.imageDialog({showRemote:false,clickFn:function(){}});setTimeout(function(){c(".ke-dialog-header").html("文件上传")},100)})};d.prototype.init=function(){var f=this.$element;var g=this.options;var i=this;f.wrap('<div class="input-group"></div>');f.before('<span class="input-group-addon btn-upload" style="cursor: pointer"><i class="fa fa-plus"></i> 上传文件...</span>');f.addClass("list-group-fileuploader");f.append('<li class="list-group-item list-group-item-placeholder"><button type="button" class="btn btn-link">&nbsp;</button></li>');i.refreshDisplay();var e=f.parent();var h=e.find(".btn-upload");h.on("click",function(){i.loadKindEditor(function(j,n){if(Config.isDebugEnable()){console.log(n)}var m=g.fileuploader;if(g.multiple){var l=f.find(".list-group-item:not(.list-group-item-placeholder)").size();m=m+"["+l+"]"}else{f.find(".list-group-item:not(.list-group-item-placeholder)").remove()}var k=[];k.push('<li class="list-group-item">');k.push(' <input type="hidden" name="'+m+'.id" value="'+n.id+'"/>');k.push(' <input type="hidden" name="'+m+'.accessUrl" value="'+n.accessUrl+'"/>');k.push(' <input type="hidden" name="'+m+'.fileRealName" value="'+n.fileRealName+'"/>');k.push(' <input type="hidden" name="'+m+'.fileLength" value="'+n.fileLength+'"/>');k.push("</li>");f.append(k.join(""));i.kindEditor.hideDialog();i.refreshDisplay()})});f.on("click",".btn-download",function(){var j=c(this);window.open(j.attr("data-url"))});f.on("click",".btn-remove",function(){var j=c(this);var k=j.closest("li.list-group-item");k.remove();i.refreshDisplay()})};d.prototype.refreshDisplay=function(){var e=this.$element;var h=this.options;var i=this;var g=function(j){if(typeof j!=="number"){return""}if(j>=1000000000){return(j/1000000000).toFixed(2)+" GB"}if(j>=1000000){return(j/1000000).toFixed(2)+" MB"}return(j/1000).toFixed(2)+" KB"};e.find(".list-group-item:not(.list-group-item-placeholder)").each(function(){var n=c(this);var m=n.find("input[name$='id']").val();if(!m){n.remove()}else{if(n.find(".btn-download").size()==0){var k=Util.smartParseURL(n.find("input[name$='.accessUrl']").val());var j=n.find("input[name$='.fileRealName']").val();var l=Number(n.find("input[name$='.fileLength']").val());n.append('<button type="button" class="btn btn-link btn-download" data-url="'+k+'">'+j+"</button>");n.append('<button type="button" class="btn btn-xs btn-circle default btn-remove pull-right" style="margin-top: 5px" title="移除附件"><i class="fa fa-minus"></i></button>');n.append('<button type="button" class="btn btn-xs btn-circle default pull-right btn-download" style="margin-top: 5px;margin-right: 5px" title="文件大小" data-url="'+k+'">'+g(l)+" </button>")}}});var f=e.find(".list-group-item:not(.list-group-item-placeholder)").size();if(f>0){e.find(".list-group-item-placeholder").hide()}else{e.find(".list-group-item-placeholder").show()}};function b(e){return this.each(function(){var h=c(this);var g=h.data("ExtFileUploader");var f=typeof e=="object"&&e;if(!g){h.data("ExtFileUploader",(g=new d(this,f)))}if(typeof e=="string"){g[e]()}})}var a=c.fn.extFileUploader;c.fn.extFileUploader=b;c.fn.extFileUploader.Constructor=d;c.fn.extFileUploader.noConflict=function(){c.fn.extFileUploader=a;return this};Global.addComponent({name:"ExtFileUploader",plugin:b,runPoint:Global.Component_Run_Point.BeforeAjaxPageShow,order:900,expr:"ul[data-fileuploader]"})}(jQuery);