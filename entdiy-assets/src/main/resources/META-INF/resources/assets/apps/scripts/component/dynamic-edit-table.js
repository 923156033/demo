+function(d){var c=function(f,e){this.$element=d(f);this.options=d.extend({},c.DEFAULTS,e);this.init()};c.VERSION="1.0.0";c.DEFAULTS={rowFormElementsExpr:"input,select,textarea"};c.resetInputAttrNameIndex=function(g,f,e){var h=g.attr(f);if(h){var i=h.substring(0,h.indexOf("[")+1)+e+h.substring(h.indexOf("]"),h.length);g.attr(f,i)}};c.prototype.init=function(){var g=this;var k=this.$element;var l=this.options;var f=k.children("tbody");var j='<button type="button" class="btn btn-xs btn-circle default btn-row-remove" title="删除当前行项" style="padding: 0px 8px;margin-right: 5px">  <i class="fa fa-minus"></i>  </button>';k.on("click",".btn-row-remove",function(q){var p=d(q.target);var n=p.closest("tr");if(l.ruleMinlength){if(f.children("tr:visible").size()==l.ruleMinlength){alert("至少需要保留 "+l.ruleMinlength+" 条行项数据");return}}var o=n.find(".dynamic-row-id");if(o.val()){n.hide();o.val("-"+o.val())}else{n.remove()}g.rebuildRowsOperation()});var h=k.find(" > thead > tr");h.prepend("<th>序号</th>");h.prepend('<th><button type="button" class="btn btn-xs btn-circle yellow btn-row-add" title="添加新行项" style="padding: 0px 8px;margin-right: 5px">  <i class="fa fa-plus"></i>  </button></th>');h.children("th").each(function(n){var o=d(this);o.attr("data-index",n)});h.find(".btn-row-add").on("click",function(){var n=d('<tr class="dynamic-edit-row">'+g.templateRowHTML+"</tr>");f.append(n);n.find(l.rowFormElementsExpr).each(function(){var o=d(this);o.attr("id",App.getUniqueID("row-el-"))});g.rebuildRowsOperation();Global.runComponents(Global.Component_Run_Point.BeforeAjaxPageShow,n);Global.runComponents(Global.Component_Run_Point.AfterAjaxPageShow,n);k.closest("form").attr("form-data-modified","true")});var m=f.children("tr");var e=0;m.each(function(o){var n=d(this);n.addClass("dynamic-edit-row");var p=n.find(".dynamic-row-id");if(p.val()){e++}n.prepend('<td class="row-num" style="min-width: 50px;padding-top: 17px;text-align: center"><span class="row-num">'+(o+1)+"</span></td>");n.prepend('<td class="row-operations" style="min-width: 30px;padding-top: 17px;">'+j+"</td>")});g.existRowCount=e;g.rebuildRowsOperation();var i=k.find(" > tbody > tr:last");i.children("td").each(function(n){var o=d(this);o.addClass("dynamic-edit-row-cell");o.attr("data-index",n)});this.templateRowHTML=i.html();if(l.ruleMinlength==undefined||m.size()>1){i.remove()}};c.prototype.rebuildRowsOperation=function(){var j=this;var h=this.$element;var i=this.options;var f=h.children("tbody");var e=f.children("tr");var g=1;var k=j.existRowCount;e.each(function(m){var l=d(this);if(l.is(":visible")){l.find("span.row-num").html((g++))}var n=l.find(".dynamic-row-id");if(n.val()==undefined||n.val()==""){l.find(i.rowFormElementsExpr).each(function(){var o=d(this);c.resetInputAttrNameIndex(o,"name",k);c.resetInputAttrNameIndex(o,"data-cascade-name",k);c.resetInputAttrNameIndex(o,"data-cascade-parent",k);c.resetInputAttrNameIndex(o,"data-rule-dateLT",k);c.resetInputAttrNameIndex(o,"data-rule-dateGT",k)});k++}})};function b(e){return this.each(function(){var h=d(this);var g=h.data("extDynamicEditTable");var f=typeof e=="object"&&e;if(!g){h.data("extDynamicEditTable",(g=new c(this,f)))}if(typeof e=="string"){g[e]()}})}var a=d.fn.extDynamicEditTable;d.fn.extDynamicEditTable=b;d.fn.extDynamicEditTable.Constructor=c;d.fn.extDynamicEditTable.noConflict=function(){d.fn.extDynamicEditTable=a;return this};Global.addComponent({name:"ExtDynamicEditTable",plugin:b,expr:"table[data-dynamic-edit-table]",order:1000})}(jQuery);