+function($){var ExtNavTree=function(element,options){this.$element=$(element);this.options=$.extend({},ExtNavTree.DEFAULTS,options);this.init()};ExtNavTree.NAME="ExtNavTree";ExtNavTree.VERSION="1.0.0";ExtNavTree.DEFAULTS={templateResult:function(data,container){return null},language:"zh-CN",tags:false,dropdownCssClass:"ext-dropdown-tree",clickMode:"toggle",onlyChildSelect:true,fetchAll:false};ExtNavTree.prototype.init=function(){var $element=this.$element;var options=this.options;var that=this;var $ztree=$element;that.$ztree=$ztree;var treeId="ztree-"+App.getUniqueID("dropdown-tree-");$ztree.attr("id",treeId);$ztree.attr("id-for",treeId);$ztree.addClass("ztree");var loopTreeItem=function(item,items){var exist=false;for(var i in items){if(items[i].id==item.id){exist=true;break}}if(!exist){items.push(item);item.isParent=true;if(item.hasChildren!=undefined&&item.hasChildren==false){item.isParent=false}var parent=item.parent;if(parent&&typeof parent=="object"){item.parent=parent.id;loopTreeItem(parent,items)}}};var ztreeDataFilter=function(data){var items=[];var content=data.content||data;$.each(content,function(i,item){loopTreeItem(item,items)});if(Config.isDebugEnable()){console.log("tree data items: ");console.log(items)}return items};var updateEventBind=function(){that.$ztree.off("dblclick");that.$ztree.on("dblclick","span[treenode_switch]",function(evt){var $switch=$(evt.target);var id=$switch.attr("id");var tId=id.replace("_switch","");var node=that.zTree.getNodeByTId(tId);that.zTree.reAsyncChildNodes(node,"refresh")})};var buildZtree=function(data,term){var zTree=that.zTree;if(zTree&&!options.fetchAll){zTree.destroy();zTree=undefined}var asyncEnable=options.parentName!=undefined;if(zTree==undefined){zTree=$.fn.zTree.init($ztree,{async:{enable:asyncEnable,url:Util.smartParseURL(options.url),type:"get",autoParam:["id="+options.parentName],dataFilter:function(treeId,parentNode,responseData){return ztreeDataFilter(responseData)}},view:{showIcon:false,autoCancelSelected:true,selectedMulti:false},data:{key:{name:"display"},simpleData:{enable:true,idKey:"id",pIdKey:"parent",rootPId:0}},callback:{beforeClick:function(treeId,treeNode,clickFlag){if(options.onlyChildSelect&&treeNode.isParent){return false}},onClick:function(event,treeId,treeNode,clickFlag){if(options.onclick){if(options.onlyChildSelect==false||treeNode.isParent==false){var $nodeLi=$(event.target).closest("li[treenode]");var $a=$nodeLi.find("a");$a.attr("node-id",treeNode.id);$a.attr("node-name",treeNode.name);var click=function(){eval(options.onclick)};click.call($a,treeId,treeNode,clickFlag)}}}}},ztreeDataFilter(data));if(options.fetchAll){zTree.expandAll(true)}that.zTree=zTree}};var ztreeAjaxLoad=function(term){var $ztree=that.$ztree;var url=options.url;url=Util.addOrReplaceUrlParameter(url,"rows","1000");url=Util.addOrReplaceUrlParameter(url,"_view","tree");if(options.fetchAll){}else{if((term==undefined||term=="")&&$element.val()){url=Util.addOrReplaceUrlParameter(url,"search[IN_id]",$element.val())}else{if($.trim(term)!=""){url=Util.addOrReplaceUrlParameter(url,options.queryName,$.trim(term))}else{url=Util.addOrReplaceUrlParameter(url,"search[NU_parent]","true")}}}if(that.cachedAllData){buildZtree(that.cachedAllData,term)}else{$ztree.parent().ajaxJsonUrl(url,function(data){if(options.fetchAll){that.cachedAllData=data}buildZtree(data,term)})}};ztreeAjaxLoad();updateEventBind()};function Plugin(option){var args=arguments;return this.each(function(){var $this=$(this);var data=$this.data("ExtNavTree");var options=$.extend({},$this.data(),typeof option=="object"&&option);if(!data){$this.data("ExtNavTree",(data=new ExtNavTree(this,options)))}if(typeof option=="string"){data[option].apply(data,$.makeArray(args).slice(1))}})}var old=$.fn.extNavTree;$.fn.extNavTree=Plugin;$.fn.extNavTree.Constructor=ExtNavTree;$.fn.extNavTree.noConflict=function(){$.fn.extNavTree=old;return this};Global.addComponent({name:"ExtNavTree",plugin:Plugin,runPoint:Global.Component_Run_Point.AfterAjaxPageShow,expr:'ul[data-toggle="nav-tree"]',order:900})}(jQuery);